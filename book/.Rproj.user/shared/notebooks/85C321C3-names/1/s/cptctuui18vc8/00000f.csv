"0","# https://www.datanovia.com/en/lessons/intraclass-correlation-coefficient-in-r/"
"0","library(irr)"
"0",""
"0","icc_fun<-function(df_in, which_rating, which_not){"
"0","  "
"0","  df_in %>%"
"0","    select(!which_not) %>%"
"0","    pivot_wider(id_cols=c(study,name), names_from = ""ResponseId"", values_from = which_rating) %>%"
"0","    ungroup() %>%"
"0","    mutate(across(where(is.numeric), ~ifelse(is.na(.x), mean(.x, na.rm = TRUE), .x))) %>%  "
"0","    group_by(study) %>%"
"0","    dplyr::select(!name) %>%"
"0","    nest() %>% "
"0","    mutate(result = map(.x = data,.f = function(x) enframe(unlist(icc(x, "
"0","                                                                      model = ""twoway"", "
"0","                                                                      type = ""agreement"", #syst diff rat"
"0","                                                                      unit = ""average""))) %>%"
"0","                          pivot_wider(names_from = ""name"", values_from = ""value""))) %>% "
"0","    unnest(result) -> df_temp"
"0","  "
"0","  return(df_temp)"
"0","}"
"0",""
"0","icc_fun(df_in = wc, which_rating=""warm"", which_not=""competent"") %>% "
"0","  filter(study %in% unique(df$study))->df_temp"
"0","#df_temp<-icc_fun(df_in = wc, which_rating=""competence"", which_not=""warm"")"
"0",""
"0","poor<-df_temp$study[df_temp$value<.5]"
"0","moderate<-df_temp$study[df_temp$value>.5 & df_temp$value<.75]"
"0","good<-df_temp$study[df_temp$value>.75 & df_temp$value<.9]"
"0","excellent<-df_temp$study[df_temp$value>.9]"
"0",""
"0","df_temp %>%"
"0","  mutate(score = case_when("
"0","    value < 0.5 ~ ""poor"","
"0","    value >= 0.5 & value < 0.75 ~ ""moderate"","
"0","    value >= 0.75 & value < 0.9 ~ ""good"","
"0","    value >= 0.9 ~ ""excellent"","
"0","    TRUE ~ NA_character_"
"0","  )) %>%"
"0","  select(study, score, value, Fvalue, lbound, ubound) %>%"
"0","  mutate_at(vars(value, Fvalue, lbound, ubound), as.numeric) %>%"
"0","  ungroup() %>%"
"0","  rename(icc=value,"
"0","         lower=lbound,"
"0","         upper=ubound) %>%"
"0","  arrange(score) %>%"
"0","  mutate_if(is.numeric, ~round(., 2)) %>%"
"0","  gt() %>%"
"0","  tab_footnote(footnote = ""Average score intraclass correlations (ICCs) were used as an index of interrater reliability of warmth competence ratings. A twoway model with random effects for raters and subjects (amount of levels in category) was used. Between rater agreement was estimated. The unit of analysis was averages."")|>"
"0","  tab_spanner("
"0","    label = ""95% CI"","
"0","    columns = c(lower,upper)) %>%"
"0","  gtsave(""table.tex"")"
