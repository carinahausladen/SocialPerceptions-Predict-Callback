"0","#| label: fig-cbpc"
"0","#| fig-cap: ""Each panel depicts distinct categories, with the first principal component plotted against callback rates. Colors represent independent studies."""
"0",""
"0","library(ggrepel)"
"0",""
"0","wc %>%"
"0","  add_column(PC1,PC2) %>%"
"0","  group_by(study, category, level) %>% "
"0","  summarise(PC1=mean(PC1, na.rm=TRUE), "
"0","            PC2=mean(PC2, na.rm=TRUE), .groups=""drop"") %>%"
"0","  left_join(cb,by=c(""study"", ""category"", ""level"")) -> df_pc"
"0",""
"0","df_pc$category <- gsub(""sexual orientation"", ""sexuality"", df_pc$category)"
"0","df_pc$category <- gsub(""military service or affiliation"", ""military"", df_pc$category)"
"0","df_pc$category <- gsub(""race and national origin"", ""nationality"", df_pc$category)"
"0",""
"0","df_pc %>%"
"0","  group_by(study) %>%"
"0","  add_count(name=""n"") %>%"
"0","  ungroup() %>%"
"0","  mutate(mean_cb=mean(callback)) %>%"
"0","  mutate(mean_PC1=mean(PC1)) ->df_plt"
"0",""
"0",""
"0","# create labels"
"0","yemane_label <- df_plt %>% filter(level %in% c(""germany"", ""russia"", ""france"", ""iraq"","
"0","                                               ""catholic"", ""jewish"", ""muslim"","
"0","                                               ""22"", ""51"","
"0","                                               ""50"", ""65""))"
"0","bind_rows(df_plt %>% "
"0","            filter(study != ""yemane"")%>% "
"0","            filter(study != ""mishel"")%>% "
"0","            filter(study != ""farber"")%>% "
"0","            filter(study != ""neumark"")%>% "
"0","            filter(study != ""wrigth""),"
"0","          yemane_label)->label_data"
"0",""
"0","  "
"0","df_plt %>%"
"0","  ggplot(aes(PC1, callback, colour = study,group = study)) +"
"0","  geom_point(size=.5, alpha=.5) +"
"0","  geom_vline(aes(xintercept = mean_PC1), size=.1, linetype=""dotted"") +"
"0","  geom_hline(aes(yintercept = mean_cb), size=.1, linetype=""dotted"") +"
"0","  gghighlight(use_direct_label = FALSE, "
"0","              label_key = level, label_params = list(size=2)) + "
"0","  geom_text_repel(data = label_data, aes(label = level),"
"0","    point.padding = 0.2, "
"0","    size=1.7,"
"0","    min.segment.length = 0,"
"0","    segment.linetype = 5,"
"0","    segment.curvature = -1e-20,"
"0","    arrow = arrow(length = unit(0.015, ""npc""))) +"
"0","  "
"0","  geom_smooth(linewidth=.4, method='glm', formula=y~x, se=F, alpha=.6)+"
"0","  facet_wrap(vars(category), ncol=9)+ "
"0","  xlab(""PC1"")+"
"0","  theme_classic()+"
"0","  theme(text = element_text(size = 9.4),"
"0","        legend.position = ""none"","
"0","        strip.background = element_blank(),"
"0","        legend.box=""vertical"", "
"0","        legend.text = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),"
"0","        legend.key.width = unit(.1, ""cm""),"
"0","        legend.key.height = unit(.1, ""cm""),"
"0","        legend.margin=margin(),"
"0","        aspect.ratio = 5/5,"
"0","        axis.text.y = element_text(size=rel(.6)),"
"0","        strip.text.x = element_blank(),"
"0","        axis.text.x = element_text(size=rel(.6)))+"
"0","  scale_x_continuous(breaks = c(-1, 0, 1))->plt3"
"0",""
"0","ggsave(plt3, filename = ""cat_plot3.pdf"", width = 7.02,height = 3, dpi = 1200, units = ""in"", device='pdf')"
